

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url = env("DATABASE_URL")
}


model User {
  id            Int     @id @default(autoincrement())
  name          String
  loginId       String 
  email         String  @unique
  passwordHash  String
  // roleId        Int
  // role          Role    @relation(fields: [roleId], references: [id])
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  // passwordOtps  PasswordResetOtp[]
  // createdPickings StockPicking[] @relation("CreatedBy")
  // validatedPickings StockPicking[] @relation("ValidatedBy")
}


model Product {
  id              String      @id @default(uuid())
  name            String
  sku             String      @unique
  category        Category?   @relation(fields: [categoryId], references: [id])
  categoryId      String?
  unit            String
  reorderLevel    Int         @default(0)
  stockMovements  StockMovement[]
}

model Category {
  id       String    @id @default(uuid())
  name     String    @unique
  products Product[]
}

model Warehouse {
  id        String        @id @default(uuid())
  name      String
  address   String?
  locations Location[]
}


model Location {
  id          String        @id @default(uuid())
  name        String
  warehouse   Warehouse     @relation(fields: [warehouseId], references: [id])
  warehouseId String
  stock       Stock[]
}

model Stock {
  id         String   @id @default(uuid())
  product    Product  @relation(fields: [productId], references: [id])
  productId  String
  location   Location @relation(fields: [locationId], references: [id])
  locationId String
  quantity   Int      @default(0)
}

model Receipt {
  id         String           @id @default(uuid())
  supplier   String?
  status     MovementStatus   @default(DRAFT)
  createdBy  User            @relation("CreatedReceipts", fields: [createdById], references: [id])
  createdById String
  items      ReceiptItem[]
  createdAt  DateTime        @default(now())
}

model ReceiptItem {
  id         String   @id @default(uuid())
  product    Product  @relation(fields: [productId], references: [id])
  productId  String
  quantity   Int
  receipt    Receipt  @relation(fields: [receiptId], references: [id])
  receiptId  String
}

model Delivery {
  id         String           @id @default(uuid())
  customer   String?
  status     MovementStatus   @default(DRAFT)
  items      DeliveryItem[]
  createdAt  DateTime        @default(now())
}

model DeliveryItem {
  id         String   @id @default(uuid())
  product    Product  @relation(fields: [productId], references: [id])
  productId  String
  quantity   Int
  delivery   Delivery @relation(fields: [deliveryId], references: [id])
  deliveryId String
}

model Movement {
  id            String        @id @default(uuid())
  product       Product       @relation(fields: [productId], references: [id])
  productId     String
  fromLocation  Location?     @relation("FromLocation", fields: [fromLocationId], references: [id])
  fromLocationId String?
  toLocation    Location?     @relation("ToLocation", fields: [toLocationId], references: [id])
  toLocationId  String?
  quantity      Int
  type          MovementType
  status        MovementStatus @default(DONE)
  createdAt     DateTime       @default(now())
}

model StockMovement {
  id        String        @id @default(uuid())
  product   Product       @relation(fields: [productId], references: [id])
  productId String
  change    Int
  reason    String?
  createdAt DateTime      @default(now())
}

enum MovementType {
  RECEIPT
  DELIVERY
  TRANSFER
  ADJUSTMENT
}

enum MovementStatus {
  DRAFT
  WAITING
  READY
  DONE
  CANCELED
}










